# USB Floppy Disk Drive Emulator

## Описание проекта

Эмулятор USB FDD на базе Raspberry Pi Pico, который позволяет использовать образы дискет с SD-карты.

### Основные возможности

- **USB Mass Storage Device** - эмуляция флоппи-дисковода через USB
- **SD Card** - хранение образов дискет (.img файлы)
- **OLED дисплей** - отображение списка доступных образов
  - Поддержка дисплеев 128x32 и 128x64 пикселей
  - I2C интерфейс (адрес 0x3C)
- **Управление**:
  - Режим с 3 кнопками (Вверх/Вниз/OK)
  - Режим с энкодером (вращение + кнопка)
- **FreeRTOS** - многозадачность и управление ресурсами

### Спецификация флоппи-дисковода

- Формат: 3.5" 1.44MB
- Размер сектора: 512 байт
- Секторов на дорожку: 18
- Головок: 2
- Дорожек: 80
- Общий размер образа: 1 474 560 байт

### Аппаратная конфигурация

#### SD Card (SPI)
- SPI порт: `spi0`
- MISO: GPIO 16
- CS: GPIO 17
- SCK: GPIO 18
- MOSI: GPIO 19

#### OLED Display (I2C)
- I2C порт: `i2c0`
- SDA: GPIO 8
- SCL: GPIO 9
- Адрес: 0x3C
- Разрешение: 128x32 (или 128x64)

#### Управление (кнопки/энкодер)
- Вариант 1 - Кнопки:
  - Вверх: GPIO 10
  - Вниз: GPIO 11
  - OK: GPIO 12
  
- Вариант 2 - Энкодер:
  - A: GPIO 10
  - B: GPIO 11
  - Кнопка: GPIO 12

### Структура проекта

```
UsbFloppyEmu/
├── CMakeLists.txt          # Основной файл сборки
├── pico_sdk_import.cmake   # Импорт Pico SDK
├── config.h                # Конфигурация GPIO и параметров
├── UsbFloppyEmu.cpp        # Главный файл
├── extras/                 # Внешние библиотеки (субмодули)
│   ├── FreeRTOS-Kernel/    # FreeRTOS v11.1.0
│   ├── pico-ssd1306/       # Драйвер OLED дисплея
│   └── fatfs/              # FAT файловая система
└── build/                  # Директория сборки
```

### Субмодули

Проект использует следующие субмодули:

1. **FreeRTOS-Kernel** (v11.1.0)
   - URL: https://github.com/FreeRTOS/FreeRTOS-Kernel.git
   - Назначение: RTOS для многозадачности

2. **pico-ssd1306**
   - URL: https://github.com/daschr/pico-ssd1306.git
   - Назначение: Драйвер OLED дисплея SSD1306

3. **fatfs**
   - URL: https://github.com/abbrev/fatfs.git
   - Назначение: FAT файловая система для работы с SD-картой

### План разработки

- [x] Инициализация проекта и подключение субмодулей
- [ ] Настройка FreeRTOS
- [ ] Реализация работы с SD-картой (SPI + FatFS)
- [ ] Подключение OLED дисплея (I2C + SSD1306)
- [ ] Реализация управления (кнопки/энкодер)
- [ ] Создание меню выбора образов
- [ ] Реализация USB Mass Storage Device
- [ ] Эмуляция флоппи-дисковода
- [ ] Тестирование и отладка

### Сборка проекта

```bash
mkdir build
cd build
cmake ..
make
```

### Прошивка

После сборки прошейте файл `UsbFloppyEmu.uf2` на Raspberry Pi Pico.

## Лицензия

TBD

## Авторы

TBD
